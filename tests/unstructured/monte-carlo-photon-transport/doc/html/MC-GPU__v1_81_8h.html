<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MC-GPU_v1.1.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>MC-GPU_v1.1.h File Reference</h1>Header file containing the declarations for the MC-GPU code.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;math.h&gt;</code><br>
<code>#include &lt;time.h&gt;</code><br>
<code>#include &lt;vector_types.h&gt;</code><br>

<p>
<a href="MC-GPU__v1_81_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><b>double3</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsource__struct.html">source_struct</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure storing the data defining the source model.  <a href="structsource__struct.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdetector__struct.html">detector_struct</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure storing the data defining the x-ray detector.  <a href="structdetector__struct.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvoxel__struct.html">voxel_struct</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure defining a voxelized box with the back-lower corner at the coordinate origin.  <a href="structvoxel__struct.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlinear__interp.html">linear_interp</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure with the basic data required by the linear interpolation of the mean free paths: number of values and energy grid.  <a href="structlinear__interp.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcompton__struct.html">compton_struct</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure storing the data of the Compton interaction sampling model (equivalent to PENELOPE's common block /CGCO/).  <a href="structcompton__struct.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrayleigh__struct.html">rayleigh_struct</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure storing the data of the Rayleigh interaction sampling model (equivalent to PENELOPE's common block /CGRA/).  <a href="structrayleigh__struct.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="155f8b8dae8b676fc50d93a287c4e6df"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::MASTER_THREAD" ref="155f8b8dae8b676fc50d93a287c4e6df" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#155f8b8dae8b676fc50d93a287c4e6df">MASTER_THREAD</a>&nbsp;&nbsp;&nbsp;if(0==myID)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">MPI macro: mark commands to be executed only by the master thread (myID==0). <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="30b26edf408e1ff6034eb712ab7e173e"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::MAX_NUM_PROJECTIONS" ref="30b26edf408e1ff6034eb712ab7e173e" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#30b26edf408e1ff6034eb712ab7e173e">MAX_NUM_PROJECTIONS</a>&nbsp;&nbsp;&nbsp;540</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Maximum number of projections allowed in the CT simulation (limited by the constant memory size):. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7aa308231ff3dcfd43ac19023e2e6e15"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::MAX_MATERIALS" ref="7aa308231ff3dcfd43ac19023e2e6e15" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15">MAX_MATERIALS</a>&nbsp;&nbsp;&nbsp;9</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constants values for the Compton and Rayleigh models:. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7fc9275784608be88cd40ac55f4de283"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::MAX_SHELLS" ref="7fc9275784608be88cd40ac55f4de283" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>MAX_SHELLS</b>&nbsp;&nbsp;&nbsp;30</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="0dece919dfaca3a705a0b67a40fe2d99"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::MAX_ENERGYBINS" ref="0dece919dfaca3a705a0b67a40fe2d99" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>MAX_ENERGYBINS</b>&nbsp;&nbsp;&nbsp;45005</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="50e5fe2bed6d3ba8c550beb81e5e40e5"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::NP_RAYLEIGH" ref="50e5fe2bed6d3ba8c550beb81e5e40e5" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NP_RAYLEIGH</b>&nbsp;&nbsp;&nbsp;128</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="598a3330b3c21701223ee0ca14316eca"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::PI" ref="598a3330b3c21701223ee0ca14316eca" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>PI</b>&nbsp;&nbsp;&nbsp;3.14159265358979323846</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c5a945020d3528355cda82d383676736"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::RAD2DEG" ref="c5a945020d3528355cda82d383676736" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>RAD2DEG</b>&nbsp;&nbsp;&nbsp;180.0/PI</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="f7e8592d0a634bd3642e9fd508ea8022"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::DEG2RAD" ref="f7e8592d0a634bd3642e9fd508ea8022" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>DEG2RAD</b>&nbsp;&nbsp;&nbsp;PI/180.0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#c0c03cf5e803404f5dc2a42467395a3a">SCALE_eV</a>&nbsp;&nbsp;&nbsp;10000.0f</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Value to scale the deposited energy in the pixels so that it can be stored as a long long integer instead of a double precision float.  <a href="#c0c03cf5e803404f5dc2a42467395a3a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4b98b60caf9dba36fca9fe41c3238404"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::EPS_SOURCE" ref="4b98b60caf9dba36fca9fe41c3238404" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>EPS_SOURCE</b>&nbsp;&nbsp;&nbsp;0.000020f</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="0bc5a0759d92c51db359dddd471d6537"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::NEG_EPS_SOURCE" ref="0bc5a0759d92c51db359dddd471d6537" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NEG_EPS_SOURCE</b>&nbsp;&nbsp;&nbsp;-0.000020f</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="12c2040f25d8e3a7b9e1c2024c618cb6"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::INF" ref="12c2040f25d8e3a7b9e1c2024c618cb6" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>INF</b>&nbsp;&nbsp;&nbsp;500000.0f</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="67d3a72aafcb824f90fee0293c6a29f5"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::INF_minus1" ref="67d3a72aafcb824f90fee0293c6a29f5" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>INF_minus1</b>&nbsp;&nbsp;&nbsp;499999.0f</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="98e3e165debaf418b6b285ff7538d3f3"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::NEG_INF" ref="98e3e165debaf418b6b285ff7538d3f3" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NEG_INF</b>&nbsp;&nbsp;&nbsp;-500000.0f</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="1b7b63b09e6ac252980467701bd80cb7"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::max_value" ref="1b7b63b09e6ac252980467701bd80cb7" args="(a, b)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#1b7b63b09e6ac252980467701bd80cb7">max_value</a>(a, b)&nbsp;&nbsp;&nbsp;( ((a) &gt; (b)) ? (a) : (b) )</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Preprocessor macro to calculate maximum and minimum values:. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="9fa6cc963655f85859604988fa68a9e2"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::min_value" ref="9fa6cc963655f85859604988fa68a9e2" args="(a, b)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>min_value</b>(a, b)&nbsp;&nbsp;&nbsp;( ((a) &lt; (b)) ? (a) : (b) )</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e1bd8b9d018ba3a5d15e2f2146be2c9e"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::double3" ref="e1bd8b9d018ba3a5d15e2f2146be2c9e" args="" -->
typedef struct double3&nbsp;</td><td class="memItemRight" valign="bottom"><b>double3</b></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#a2f5da38f6311a306a4fac637f8872bb">read_input</a> (int argc, char **argv, int myID, unsigned long long int *total_histories, int *gpu_id, int *seed_input, int *num_threads_per_block, int *histories_per_thread, struct <a class="el" href="structdetector__struct.html">detector_struct</a> *detector_data, unsigned long long int **image_ptr, int *image_bytes, struct <a class="el" href="structsource__struct.html">source_struct</a> *source_data, char *file_name_voxels, char file_name_materials[MAX_MATERIALS][250], char *file_name_output, int *num_projections, double *D_angle, double *angularROI_0, double *angularROI_1, double *initial_angle)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the input file given in the command line and return the significant data.  <a href="#a2f5da38f6311a306a4fac637f8872bb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#1daa1f1df034e2ed743ee7012e427222">load_voxels</a> (int myID, char *file_name_voxels, float *density_max, struct <a class="el" href="structvoxel__struct.html">voxel_struct</a> *voxel_data, float2 **voxel_mat_dens_ptr, unsigned int *voxel_mat_dens_bytes)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the voxel data and allocate the material and density matrix.  <a href="#1daa1f1df034e2ed743ee7012e427222"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#d23b50cb34b4aadcd24d9fec7e47ad24">load_material</a> (int myID, char file_name_materials[MAX_MATERIALS][250], float *density_max, float *density_nominal, struct <a class="el" href="structlinear__interp.html">linear_interp</a> *mfp_table_data, float2 **mfp_Woodcock_table, int *mfp_Woodcock_table_bytes, float3 **mfp_table_a_ptr, float3 **mfp_table_b_ptr, int *mfp_table_bytes, struct <a class="el" href="structrayleigh__struct.html">rayleigh_struct</a> *rayleigh_table_ptr, struct <a class="el" href="structcompton__struct.html">compton_struct</a> *compton_table_ptr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the material input files and set the mean free paths and the "linear_interp" structures.  <a href="#d23b50cb34b4aadcd24d9fec7e47ad24"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#96dba25b308814b25fbae71e27617f12">trim_name</a> (char *input_line, char *file_name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Extract a file name from an input text line, trimming the initial blanks, trailing comment (#) and stopping at the first blank (the file name should not contain blanks).  <a href="#96dba25b308814b25fbae71e27617f12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#ea168bca1466813e03b649931a4f670f">fgets_trimmed</a> (char *trimmed_line, int num, FILE *file_ptr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read a line of text and trim initial blancks and trailing comments (#).  <a href="#ea168bca1466813e03b649931a4f670f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#39db69f5efdcc4012bddf911e8a78691">report_host</a> (char *file_name_output, struct <a class="el" href="structdetector__struct.html">detector_struct</a> *detector_data, struct <a class="el" href="structsource__struct.html">source_struct</a> *source_data, unsigned long long int *image, double time_elapsed, unsigned long long int total_histories, int current_projection, int num_projections, double D_angle, double initial_angle, int myID, int numprocs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Report the final results, from the host CPU.  <a href="#39db69f5efdcc4012bddf911e8a78691"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#db95164a1253ee2aafeab8a5e0a8e7e3">set_CT_trajectory</a> (int myID, int num_projections, double D_angle, double angularROI_0, double angularROI_1, struct <a class="el" href="structsource__struct.html">source_struct</a> *source_data, struct <a class="el" href="structdetector__struct.html">detector_struct</a> *detector_data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets the CT trajectory: store in memory the source and detector rotations that are needed to calculate the multiple projections.  <a href="#db95164a1253ee2aafeab8a5e0a8e7e3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#bca9364385e0606e5a89c50ff0e8d54a">track_particles</a> (int history_batch, int histories_per_thread, int num_p, int seed_input, unsigned long long int *image, float2 *voxel_mat_dens, float2 *mfp_Woodcock_table, float3 *mfp_table_a, float3 *mfp_table_b, struct <a class="el" href="structrayleigh__struct.html">rayleigh_struct</a> *rayleigh_table, struct <a class="el" href="structcompton__struct.html">compton_struct</a> *compton_table)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main function to simulate x-ray tracks inside a voxelized geometry.  <a href="#bca9364385e0606e5a89c50ff0e8d54a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#d58a7b0dc497439d0d63e9015b0aa0cb">source</a> (int *num_p, float3 *position, float3 *direction, float *energy, int2 *seed, int *absvox)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Source that creates primary x rays, according to the defined source model.  <a href="#d58a7b0dc497439d0d63e9015b0aa0cb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#89bad1e6819d520cce606a8aa8f2cfbc">set_position</a> (int *num_p, float *dist, float3 *position, float3 *direction)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Evaluate if the input distance will move the particle inside the voxels or if another distance has to be used.  <a href="#89bad1e6819d520cce606a8aa8f2cfbc"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#72817a5712f873a61ad5408a781620be">tally_image</a> (int *num_p, float *energy, float3 *position, float3 *direction, signed char *scatter_state, unsigned long long int *image, float3 *detector_center_SHARED)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tally a radiographic projection image.  <a href="#72817a5712f873a61ad5408a781620be"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#e7bd0b93b4d5eedb15822fa0ef622b48">init_PRNG</a> (int history_batch, int histories_per_thread, int seed_input, int2 *seed)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the pseudo-random number generator (PRNG) RANECU to a position far away from the previous history (leap frog technique).  <a href="#e7bd0b93b4d5eedb15822fa0ef622b48"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#e9061f4314474bf4415200a5cb115397">abMODm</a> (int m, int a, int s)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculate "(a1*a2) MOD m" with 32-bit integers and avoiding the possible overflow, using the Russian Peasant approach modulo m and the approximate factoring method, as described in: L'Ecuyer and Cote, ACM Trans.  <a href="#e9061f4314474bf4415200a5cb115397"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#3b57f2faa5765ceba5d352641ca72a9f">ranecu</a> (int2 *seed)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pseudo-random number generator (PRNG) RANECU returning a float value (single precision version).  <a href="#3b57f2faa5765ceba5d352641ca72a9f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="74c4894502584f8fb113e04b759a6c55"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::ranecu_double" ref="74c4894502584f8fb113e04b759a6c55" args="(int2 *seed)" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#74c4894502584f8fb113e04b759a6c55">ranecu_double</a> (int2 *seed)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pseudo-random number generator (PRNG) RANECU returning a double value. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#6ce03af860514f703cbf18f217ec1df0">locate_voxel</a> (float3 *position)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find the voxel that contains the current position.  <a href="#6ce03af860514f703cbf18f217ec1df0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#cc5186c685730d287039c737445bbe43">rotate_double</a> (float3 *direction, double cos_theta, double phi)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rotates a vector; the rotation is specified by giving the polar and azimuthal angles in the "self-frame", as determined by the vector to be rotated.  <a href="#cc5186c685730d287039c737445bbe43"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#5cafd4ebb3d155746b16ca7d231ecad1">GRAa</a> (float *energy, double *costh_Rayleigh, int *mat, float *pmax_current, int2 *seed, struct <a class="el" href="structrayleigh__struct.html">rayleigh_struct</a> *cgra)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sample a Rayleigh interaction using the sampling algorithm used in PENELOPE 2006.  <a href="#5cafd4ebb3d155746b16ca7d231ecad1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#6f212862e7fba1553ec9495f05443b2c">GCOa</a> (float *energy, double *costh_Compton, int *mat, int2 *seed, struct <a class="el" href="structcompton__struct.html">compton_struct</a> *cgco_SHARED)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Random sampling of incoherent (Compton) scattering of photons, using the sampling algorithm from PENELOPE 2006: Relativistic impulse approximation with analytical one-electron Compton profiles.  <a href="#6f212862e7fba1553ec9495f05443b2c"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="129396d7723d11e10c673c1171773cdc"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::voxel_data_CONST" ref="129396d7723d11e10c673c1171773cdc" args="" -->
struct <a class="el" href="structvoxel__struct.html">voxel_struct</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#129396d7723d11e10c673c1171773cdc">voxel_data_CONST</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Global variable to be stored in the GPU constant memory defining the size of the voxel phantom. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="1b4da9b1f73994c4ed1aa7aafd036428"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::source_data_CONST" ref="1b4da9b1f73994c4ed1aa7aafd036428" args="" -->
struct <a class="el" href="structsource__struct.html">source_struct</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#1b4da9b1f73994c4ed1aa7aafd036428">source_data_CONST</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Global variable to be stored in the GPU constant memory defining the x-ray source. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ea632931ac52bff8d7c9e9cb4e63fd7a"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::detector_data_CONST" ref="ea632931ac52bff8d7c9e9cb4e63fd7a" args="" -->
struct <a class="el" href="structdetector__struct.html">detector_struct</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#ea632931ac52bff8d7c9e9cb4e63fd7a">detector_data_CONST</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Global variable to be stored in the GPU constant memory defining the x-ray detector. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="8a3e410fb23d04f8a27d3d71c2381d24"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::mfp_table_data_CONST" ref="8a3e410fb23d04f8a27d3d71c2381d24" args="" -->
struct <a class="el" href="structlinear__interp.html">linear_interp</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8h.html#8a3e410fb23d04f8a27d3d71c2381d24">mfp_table_data_CONST</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Global variable to be stored in the GPU constant memory defining the linear interpolation data. <br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Header file containing the declarations for the MC-GPU code. 
<p>
This file declares all the host and device functions and structures, the library files to include in the compilation, various constants parameters of the simulation, pre-processor macro functions, etc. <dl class="author" compact><dt><b>Author:</b></dt><dd>Andreu Badal (<a href="mailto:Andreu.Badal-Soler@fda.hhs.gov">Andreu.Badal-Soler@fda.hhs.gov</a>) </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>2010/05/14 </dd></dl>

<p>Definition in file <a class="el" href="MC-GPU__v1_81_8h-source.html">MC-GPU_v1.1.h</a>.</p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="c0c03cf5e803404f5dc2a42467395a3a"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::SCALE_eV" ref="c0c03cf5e803404f5dc2a42467395a3a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SCALE_eV&nbsp;&nbsp;&nbsp;10000.0f          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Value to scale the deposited energy in the pixels so that it can be stored as a long long integer instead of a double precision float. 
<p>
The integer values have to be used in order to use the atomicAdd function in CUDA. 
<p>Definition at line <a class="el" href="MC-GPU__v1_81_8h-source.html#l00073">73</a> of file <a class="el" href="MC-GPU__v1_81_8h-source.html">MC-GPU_v1.1.h</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01543">report_host()</a>, and <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00370">tally_image()</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="e9061f4314474bf4415200a5cb115397"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::abMODm" ref="e9061f4314474bf4415200a5cb115397" args="(int m, int a, int s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int abMODm           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>s</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Calculate "(a1*a2) MOD m" with 32-bit integers and avoiding the possible overflow, using the Russian Peasant approach modulo m and the approximate factoring method, as described in: L'Ecuyer and Cote, ACM Trans. 
<p>
Math. Soft. 17 (1991).<p>
This function has been adapted from "seedsMLCG.f", see: Badal and Sempau, Computer Physics Communications 175 (2006)<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>m,a,s</em>&nbsp;</td><td>MLCG parameters </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>(a1*a2) MOD m </dd></dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00882">882</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00804">init_PRNG()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ea168bca1466813e03b649931a4f670f"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::fgets_trimmed" ref="ea168bca1466813e03b649931a4f670f" args="(char *trimmed_line, int num, FILE *file_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* fgets_trimmed           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>trimmed_line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>file_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read a line of text and trim initial blancks and trailing comments (#). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>num</em>&nbsp;</td><td>Characters to read </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>file_ptr</em>&nbsp;</td><td>Pointer to the input file stream </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>trimmed_line</em>&nbsp;</td><td>Trimmed line from input file, skipping empty lines and comments </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00969">969</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00542">read_input()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6f212862e7fba1553ec9495f05443b2c"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::GCOa" ref="6f212862e7fba1553ec9495f05443b2c" args="(float *energy, double *costh_Compton, int *mat, int2 *seed, struct compton_struct *cgco_SHARED)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GCOa           </td>
          <td>(</td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>energy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>costh_Compton</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int2 *&nbsp;</td>
          <td class="paramname"> <em>seed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcompton__struct.html">compton_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>cgco_SHARED</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Random sampling of incoherent (Compton) scattering of photons, using the sampling algorithm from PENELOPE 2006: Relativistic impulse approximation with analytical one-electron Compton profiles. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>energy</em>&nbsp;</td><td>incident and final photon energy (eV) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>costh_Compton</em>&nbsp;</td><td>cosine of the polar scattering angle </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>material</em>&nbsp;</td><td>Current voxel material </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>seed</em>&nbsp;</td><td>RANECU PRNG seed </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l01256">1256</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00201">compton_struct::fco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00201">compton_struct::fj0</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00060">MAX_MATERIALS</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00081">max_value</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00204">compton_struct::noscco</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00928">ranecu()</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00201">compton_struct::uico</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">track_particles()</a>.</p>

</div>
</div><p>
<a class="anchor" name="5cafd4ebb3d155746b16ca7d231ecad1"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::GRAa" ref="5cafd4ebb3d155746b16ca7d231ecad1" args="(float *energy, double *costh_Rayleigh, int *mat, float *pmax_current, int2 *seed, struct rayleigh_struct *cgra)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GRAa           </td>
          <td>(</td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>energy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>costh_Rayleigh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>pmax_current</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int2 *&nbsp;</td>
          <td class="paramname"> <em>seed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structrayleigh__struct.html">rayleigh_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>cgra</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sample a Rayleigh interaction using the sampling algorithm used in PENELOPE 2006. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>energy</em>&nbsp;</td><td>Particle energy (not modified with Rayleigh) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>costh_Rayleigh</em>&nbsp;</td><td>Cosine of the angular deflection </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>material</em>&nbsp;</td><td>Current voxel material </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l01150">1150</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::aco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::bco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00219">rayleigh_struct::itlco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00219">rayleigh_struct::ituco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::pco</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00958">ranecu_double()</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::xco</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">track_particles()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e7bd0b93b4d5eedb15822fa0ef622b48"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::init_PRNG" ref="e7bd0b93b4d5eedb15822fa0ef622b48" args="(int history_batch, int histories_per_thread, int seed_input, int2 *seed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_PRNG           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>history_batch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>histories_per_thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>seed_input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int2 *&nbsp;</td>
          <td class="paramname"> <em>seed</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize the pseudo-random number generator (PRNG) RANECU to a position far away from the previous history (leap frog technique). 
<p>
Each calculated seed initiates a consecutive and disjoint sequence of pseudo-random numbers with length LEAP_DISTANCE, that can be used to in a parallel simulation (Sequence Splitting parallelization method). The basic equation behind the algorithm is: S(i+j) = (a**j * S(i)) MOD m = [(a**j MOD m)*S(i)] MOD m , which is described in: P L'Ecuyer, Commun. ACM 31 (1988) p.742<p>
This function has been adapted from "seedsMLCG.f", see: A Badal and J Sempau, Computer Physics Communications 175 (2006) p. 440-450<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>history</em>&nbsp;</td><td>Particle bach number. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>seed_input</em>&nbsp;</td><td>Initial PRNG seed input (used to initiate both MLCGs in RANECU). </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>seed</em>&nbsp;</td><td>Initial PRNG seeds for the present history. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00804">804</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00777">a1_RANECU</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00882">abMODm()</a>, and <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00775">LEAP_DISTANCE</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">track_particles()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d23b50cb34b4aadcd24d9fec7e47ad24"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::load_material" ref="d23b50cb34b4aadcd24d9fec7e47ad24" args="(int myID, char file_name_materials[MAX_MATERIALS][250], float *density_max, float *density_nominal, struct linear_interp *mfp_table_data, float2 **mfp_Woodcock_table, int *mfp_Woodcock_table_bytes, float3 **mfp_table_a_ptr, float3 **mfp_table_b_ptr, int *mfp_table_bytes, struct rayleigh_struct *rayleigh_table_ptr, struct compton_struct *compton_table_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void load_material           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>file_name_materials</em>[MAX_MATERIALS][250], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>density_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>density_nominal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlinear__interp.html">linear_interp</a> *&nbsp;</td>
          <td class="paramname"> <em>mfp_table_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float2 **&nbsp;</td>
          <td class="paramname"> <em>mfp_Woodcock_table_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>mfp_Woodcock_table_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 **&nbsp;</td>
          <td class="paramname"> <em>mfp_table_a_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 **&nbsp;</td>
          <td class="paramname"> <em>mfp_table_b_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>mfp_table_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structrayleigh__struct.html">rayleigh_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>rayleigh_table_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcompton__struct.html">compton_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>compton_table_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read the material input files and set the mean free paths and the "linear_interp" structures. 
<p>
Find the material nominal density. Set the Woodcock trick data.<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>file_name_materials</em>&nbsp;</td><td>Array with the names of the material files. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>density_max</em>&nbsp;</td><td>maximum density in the geometry (needed to set Woodcock trick) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>density_nominal</em>&nbsp;</td><td>Array with the nominal density of the materials read </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>mfp_table_data</em>&nbsp;</td><td>Constant values for the linear interpolation </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>mfp_table_a_ptr</em>&nbsp;</td><td>First element for the linear interpolation. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>mfp_table_b_ptr</em>&nbsp;</td><td>Second element for the linear interpolation. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01166">1166</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::aco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::bco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00189">linear_interp::e0</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00201">compton_struct::fco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00201">compton_struct::fj0</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00189">linear_interp::ide</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00219">rayleigh_struct::itlco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00219">rayleigh_struct::ituco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00054">MASTER_THREAD</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00204">compton_struct::noscco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00188">linear_interp::num_values</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::pco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::pmax</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00201">compton_struct::uico</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::xco</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="1daa1f1df034e2ed743ee7012e427222"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::load_voxels" ref="1daa1f1df034e2ed743ee7012e427222" args="(int myID, char *file_name_voxels, float *density_max, struct voxel_struct *voxel_data, float2 **voxel_mat_dens_ptr, unsigned int *voxel_mat_dens_bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void load_voxels           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name_voxels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>density_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structvoxel__struct.html">voxel_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>voxel_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float2 **&nbsp;</td>
          <td class="paramname"> <em>voxel_mat_dens_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>voxel_mat_dens_bytes</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read the voxel data and allocate the material and density matrix. 
<p>
Also find and report the maximum density defined in the geometry.<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>file_name_voxels</em>&nbsp;</td><td>Name of the voxelized geometry file. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>density_max</em>&nbsp;</td><td>Array with the maximum density for each material in the voxels. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>voxel_data</em>&nbsp;</td><td>Pointer to a structure containing the voxel number and size. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>voxel_mat_dens_ptr</em>&nbsp;</td><td>Pointer to the vector with the voxel materials and densities. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01029">1029</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00176">voxel_struct::inv_voxel_size</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00054">MASTER_THREAD</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00060">MAX_MATERIALS</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00175">voxel_struct::num_voxels</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00176">voxel_struct::size_bbox</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6ce03af860514f703cbf18f217ec1df0"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::locate_voxel" ref="6ce03af860514f703cbf18f217ec1df0" args="(float3 *position)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int locate_voxel           </td>
          <td>(</td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>position</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Find the voxel that contains the current position. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>position</em>&nbsp;</td><td>Particle position </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>voxel_data</em>&nbsp;</td><td>Pointer to a structure containing the voxel number and size. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Returns "absvox", the voxel number where the particle is located (negative if position outside the voxel bbox). </dd></dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00994">994</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00176">voxel_struct::inv_voxel_size</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00175">voxel_struct::num_voxels</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00176">voxel_struct::size_bbox</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00256">voxel_data_CONST</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">track_particles()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3b57f2faa5765ceba5d352641ca72a9f"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::ranecu" ref="3b57f2faa5765ceba5d352641ca72a9f" args="(int2 *seed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ranecu           </td>
          <td>(</td>
          <td class="paramtype">int2 *&nbsp;</td>
          <td class="paramname"> <em>seed</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pseudo-random number generator (PRNG) RANECU returning a float value (single precision version). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>seed</em>&nbsp;</td><td>PRNG seed (seed kept in the calling function and updated here). </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>PRN double value in the open interval (0,1) </dd></dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00928">928</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l01256">GCOa()</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00485">source()</a>, and <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">track_particles()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a2f5da38f6311a306a4fac637f8872bb"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::read_input" ref="a2f5da38f6311a306a4fac637f8872bb" args="(int argc, char **argv, int myID, unsigned long long int *total_histories, int *gpu_id, int *seed_input, int *num_threads_per_block, int *histories_per_thread, struct detector_struct *detector_data, unsigned long long int **image_ptr, int *image_bytes, struct source_struct *source_data, char *file_name_voxels, char file_name_materials[MAX_MATERIALS][250], char *file_name_output, int *num_projections, double *D_angle, double *angularROI_0, double *angularROI_1, double *initial_angle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_input           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int *&nbsp;</td>
          <td class="paramname"> <em>total_histories</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>seed_input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>gpu_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>num_threads_per_block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>histories_per_thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdetector__struct.html">detector_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>detector_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int **&nbsp;</td>
          <td class="paramname"> <em>image_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>image_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsource__struct.html">source_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>source_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name_voxels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>file_name_materials</em>[MAX_MATERIALS][250], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name_output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>num_projections</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>D_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>angularROI_0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>angularROI_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>initial_angle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read the input file given in the command line and return the significant data. 
<p>
Example input file:<p>
1000000 [Total number of histories to simulate] geometry.vox [Voxelized geometry file name] material.mat [Material data file name]<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>argc</em>&nbsp;</td><td>Command line parameters </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>argv</em>&nbsp;</td><td>Command line parameters: name opf input file </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>total_histories</em>&nbsp;</td><td>Total number of particles to simulate </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>seed_input</em>&nbsp;</td><td>Input random number generator seed </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>num_threads_per_block</em>&nbsp;</td><td>Number of CUDA threads for each GPU block </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>detector_data</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>image</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>source_data</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>file_name_voxels</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>file_name_materials</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>file_name_output</em>&nbsp;</td><td></td></tr>
  </table>
</dl>

<p>
!DeBuG!! Force square field for any phi!! 
<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00542">542</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00156">detector_struct::corner_min_rotated_to_Y</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::cos_theta_low</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::D_cos_theta</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::D_phi</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::direction</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::energy</a>, <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00969">fgets_trimmed()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::height_Z</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_X</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_Z</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00054">MASTER_THREAD</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::max_height_at_y1cm</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00162">detector_struct::num_pixels</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::phi_low</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::position</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::rot_fan</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::rot_inv</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00163">detector_struct::rotation_flag</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00155">detector_struct::sdd</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00163">detector_struct::total_num_pixels</a>, <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00941">trim_name()</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::width_X</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="39db69f5efdcc4012bddf911e8a78691"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::report_host" ref="39db69f5efdcc4012bddf911e8a78691" args="(char *file_name_output, struct detector_struct *detector_data, struct source_struct *source_data, unsigned long long int *image, double time_elapsed, unsigned long long int total_histories, int current_projection, int num_projections, double D_angle, double initial_angle, int myID, int numprocs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int report_host           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name_output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdetector__struct.html">detector_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>detector_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsource__struct.html">source_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>source_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int *&nbsp;</td>
          <td class="paramname"> <em>image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>time_elapsed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int&nbsp;</td>
          <td class="paramname"> <em>total_histories</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>current_projection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num_projections</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>D_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>initial_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numprocs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Report the final results, from the host CPU. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>file_name_output</em>&nbsp;</td><td>File where tallied image is reported </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>detector_data</em>&nbsp;</td><td>Detector description read from the input file (pointer to <a class="el" href="structdetector__struct.html" title="Structure storing the data defining the x-ray detector.">detector_struct</a>) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>image</em>&nbsp;</td><td>Tallied image (in meV per pixel) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>time_elapsed</em>&nbsp;</td><td>Time elapsed during the main loop execution (in seconds) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>total_histories</em>&nbsp;</td><td>Total number of x-rays simulated </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01543">1543</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::energy</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_X</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_Z</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00162">detector_struct::num_pixels</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00073">SCALE_eV</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="cc5186c685730d287039c737445bbe43"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::rotate_double" ref="cc5186c685730d287039c737445bbe43" args="(float3 *direction, double cos_theta, double phi)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rotate_double           </td>
          <td>(</td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>costh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>phi</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Rotates a vector; the rotation is specified by giving the polar and azimuthal angles in the "self-frame", as determined by the vector to be rotated. 
<p>
This function is a literal translation from Fortran to C of PENELOPE (v. 2006) subroutine "DIRECT".<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>(u,v,w)</em>&nbsp;</td><td>input vector (=d) in the lab. frame; returns the rotated vector components in the lab. frame </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>costh</em>&nbsp;</td><td>cos(theta), angle between d before and after turn </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>phi</em>&nbsp;</td><td>azimuthal angle (rad) turned by d in its self-frame </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l01072">1072</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">track_particles()</a>.</p>

</div>
</div><p>
<a class="anchor" name="db95164a1253ee2aafeab8a5e0a8e7e3"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::set_CT_trajectory" ref="db95164a1253ee2aafeab8a5e0a8e7e3" args="(int myID, int num_projections, double D_angle, double angularROI_0, double angularROI_1, struct source_struct *source_data, struct detector_struct *detector_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_CT_trajectory           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num_projections</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>D_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>angularROI_0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>angularROI_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsource__struct.html">source_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>source_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdetector__struct.html">detector_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>detector_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sets the CT trajectory: store in memory the source and detector rotations that are needed to calculate the multiple projections. 
<p>
The first projection (0) was previously initialized in function "read_input".<p>
ASSUMPTIONS: the CT scan plane must be perpendicular to the Z axis, ie, the initial direction of the particles must have w=0! 
<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01650">1650</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00156">detector_struct::corner_min_rotated_to_Y</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::direction</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::height_Z</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00054">MASTER_THREAD</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::position</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::rot_fan</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::rot_inv</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00155">detector_struct::sdd</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::width_X</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="89bad1e6819d520cce606a8aa8f2cfbc"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::set_position" ref="89bad1e6819d520cce606a8aa8f2cfbc" args="(int *num_p, float *dist, float3 *position, float3 *direction)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int set_position           </td>
          <td>(</td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>num_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>dist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>position</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>direction</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Evaluate if the input distance will move the particle inside the voxels or if another distance has to be used. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dist</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>position</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 (true) or 0 (false) integer value telling if the distance is acceptable or not. </dd></dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00751">751</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::position</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00176">voxel_struct::size_bbox</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00262">source_data_CONST</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00256">voxel_data_CONST</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00485">source()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d58a7b0dc497439d0d63e9015b0aa0cb"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::source" ref="d58a7b0dc497439d0d63e9015b0aa0cb" args="(int *num_p, float3 *position, float3 *direction, float *energy, int2 *seed, int *absvox)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void source           </td>
          <td>(</td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>num_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>position</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>energy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int2 *&nbsp;</td>
          <td class="paramname"> <em>seed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>absvox</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Source that creates primary x rays, according to the defined source model. 
<p>
The particles are automatically moved to the surface of the voxel bounding box, to start the tracking inside a real material. If the sampled particle do not enter the voxels, it is init in the focal spot and the main program will check if it arrives at the detector or not.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>source_data</em>&nbsp;</td><td>Structure describing the source. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>position</em>&nbsp;</td><td>Initial particle position (particle transported inside the voxel bbox). </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>direction</em>&nbsp;</td><td>Sampled particle direction (cosine vectors). </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>energy</em>&nbsp;</td><td>Sampled energy of the new x ray. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>seed</em>&nbsp;</td><td>Current seed of the random number generator, requiered to sample the movement direction. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>absvox</em>&nbsp;</td><td>Set to &lt;0 if primary particle will not cross the voxels, not changed otherwise (&gt;0). </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00485">485</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::cos_theta_low</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::D_cos_theta</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::D_phi</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00268">detector_data_CONST</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::energy</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::max_height_at_y1cm</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::phi_low</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::position</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00928">ranecu()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::rot_fan</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00163">detector_struct::rotation_flag</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00751">set_position()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00176">voxel_struct::size_bbox</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00262">source_data_CONST</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00256">voxel_data_CONST</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">track_particles()</a>.</p>

</div>
</div><p>
<a class="anchor" name="72817a5712f873a61ad5408a781620be"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::tally_image" ref="72817a5712f873a61ad5408a781620be" args="(int *num_p, float *energy, float3 *position, float3 *direction, signed char *scatter_state, unsigned long long int *image, float3 *detector_center_SHARED)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tally_image           </td>
          <td>(</td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>num_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>energy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>position</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">signed char *&nbsp;</td>
          <td class="paramname"> <em>scatter_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int *&nbsp;</td>
          <td class="paramname"> <em>image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>detector_center_SHARED</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Tally a radiographic projection image. 
<p>
This function is called whenever a particle escapes the voxelized volume. The code checks if the particle would arrive at the detector if it kept moving in a straight line after exiting the voxels (assuming vacuum enclosure). An ideal image formation model is implemented: each pixel counts the total energy of the x rays that enter the pixel (100% detection efficiency for any energy). The image due to primaries and different kinds of scatter is tallied separately.<p>
In the GPU, and atomicAdd() function is used to make sure that multiple threads do not update the same pixel at the same time, which would result in a lose of information. Since the atomicAdd function is only available for 'unsigned long long int' data, the float pixel values are scaled by a factor "SCALE_eV" defined in the header file (eg, define SCALE_eV 10000.0f) and stored as unsigned long long integers in main memory.<p>
WARNING! If the total tallied signal (for all particles) is larger than "1.8e19/SCALE_eV", there will be a bit overflow and the value will be reset to 0 giving bogus results.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>energy</em>&nbsp;</td><td>X-ray energy </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>position</em>&nbsp;</td><td>Particle position </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>direction</em>&nbsp;</td><td>Particle direction (cosine vectors) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>scatter_state</em>&nbsp;</td><td>Flag marking primaries, single Compton, single Rayleigh or multiple scattered radiation </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>image</em>&nbsp;</td><td>Integer array containing the image, ie, the pixel values (in tenths of meV) </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00370">370</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00156">detector_struct::corner_min_rotated_to_Y</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00268">detector_data_CONST</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::direction</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_X</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_Z</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00162">detector_struct::num_pixels</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::rot_inv</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00163">detector_struct::rotation_flag</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00073">SCALE_eV</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00155">detector_struct::sdd</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00262">source_data_CONST</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00163">detector_struct::total_num_pixels</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">track_particles()</a>.</p>

</div>
</div><p>
<a class="anchor" name="bca9364385e0606e5a89c50ff0e8d54a"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::track_particles" ref="bca9364385e0606e5a89c50ff0e8d54a" args="(int history_batch, int histories_per_thread, int num_p, int seed_input, unsigned long long int *image, float2 *voxel_mat_dens, float2 *mfp_Woodcock_table, float3 *mfp_table_a, float3 *mfp_table_b, struct rayleigh_struct *rayleigh_table, struct compton_struct *compton_table)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void track_particles           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>history_batch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>histories_per_thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>seed_input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int *&nbsp;</td>
          <td class="paramname"> <em>image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float2 *&nbsp;</td>
          <td class="paramname"> <em>voxel_mat_dens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float2 *&nbsp;</td>
          <td class="paramname"> <em>mfp_Woodcock_table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>mfp_table_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 *&nbsp;</td>
          <td class="paramname"> <em>mfp_table_b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structrayleigh__struct.html">rayleigh_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>rayleigh_table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcompton__struct.html">compton_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>compton_table</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Main function to simulate x-ray tracks inside a voxelized geometry. 
<p>
Secondary electrons are not simulated (in photoelectric and Compton events the energy is locally deposited).<p>
The following global variables, in the GPU __constant__ memory are used: voxel_data_CONST, source_data_CONST, detector_data_CONST, mfp_table_data_CONST.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>history_batch</em>&nbsp;</td><td>Particle batch number (only used in the CPU version when CUDA is disabled!, the GPU uses the built-in variable threadIdx) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>num_p</em>&nbsp;</td><td>Projection number in the CT simulation. This variable defines a specific angle and the corresponding source and detector will be used. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>histories_per_thread</em>&nbsp;</td><td>Number of histories to simulate for each call to this function (ie, for GPU thread). </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>seed_input</em>&nbsp;</td><td>Random number generator seed (the same seed is used to initialize the two MLCGs of RANECU). </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>voxel_mat_dens</em>&nbsp;</td><td>Pointer to the voxel densities and material vector (the voxelized geometry), stored in GPU glbal memory. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mfp_Woodcock_table</em>&nbsp;</td><td>Two parameter table for the linear interpolation of the Woodcock mean free path (MFP) (stored in GPU global memory). </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mfp_table_a</em>&nbsp;</td><td>First element for the linear interpolation of the interaction mean free paths (stored in GPU global memory). </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mfp_table_b</em>&nbsp;</td><td>Second element for the linear interpolation of the interaction mean free paths (stored in GPU global memory). </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rayleigh_table</em>&nbsp;</td><td>Pointer to the table with the data required by the Rayleigh interaction sampling, stored in GPU global memory. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>compton_table</em>&nbsp;</td><td>Pointer to the table with the data required by the Compton interaction sampling, stored in GPU global memory. </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>image</em>&nbsp;</td><td>Pointer to the image vector in the GPU glbal memory. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">111</a> of file <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00268">detector_data_CONST</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::direction</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00189">linear_interp::e0</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::energy</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l01256">GCOa()</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l01150">GRAa()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00189">linear_interp::ide</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00804">init_PRNG()</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00994">locate_voxel()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00060">MAX_MATERIALS</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00274">mfp_table_data_CONST</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::pmax</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::position</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00928">ranecu()</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00958">ranecu_double()</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l01072">rotate_double()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00155">detector_struct::sdd</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00485">source()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00262">source_data_CONST</a>, and <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00370">tally_image()</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="96dba25b308814b25fbae71e27617f12"></a><!-- doxytag: member="MC&#45;GPU_v1.1.h::trim_name" ref="96dba25b308814b25fbae71e27617f12" args="(char *input_line, char *file_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void trim_name           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>input_line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Extract a file name from an input text line, trimming the initial blanks, trailing comment (#) and stopping at the first blank (the file name should not contain blanks). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>input_line</em>&nbsp;</td><td>Input sentence with blanks and a trailing comment </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>file_name</em>&nbsp;</td><td>Trimmed file name </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00941">941</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00542">read_input()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Jun 3 13:10:12 2010 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>

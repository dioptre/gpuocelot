<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MC-GPU v1.1</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>MC-GPU v1.1</h1>
<p>
<b>MC-GPU</b> is an x ray transport simulation code that can generate radiographic projection images and computed tomography (CT) scans of voxelized objects, including realistic human anatomy phantoms. The code implements a massively multi-threaded Monte Carlo simulation algorithm for the transport of x rays in a voxelized geometry. The program has been developed using the <b>CUDA</b> programming model and the simulation can be executed in parallel in a state-of-the-art GPU from <b>NVIDIA</b>, giving an speed up of the order of 15-25 times, compared to a CPU execution. The x ray interaction models and cross sections have been adapted from <b>PENELOPE</b> <b>2006</b>. Currently, the code does not transport secondary electrons and the electrons that would be created in photoelectric and Compton events are assumed to be locally absorbed (dose is not reported).<p>
The MC-GPU code has been described in different scientific publications. A brief description of the code features is given below. This description has been taken from the main paper that can be cited to refer to this code:<p>
<div class="fragment"><pre class="fragment">  Andreu Badal and Aldo Badano, <span class="stringliteral">"Accelerating Monte Carlo simulations of photon transport in a voxelized</span>
<span class="stringliteral">  geometry using a massively parallel Graphics Processing Unit"</span>, Medical Physics 36, pp. 4878â€“4880 (2009)
</pre></div><p>
This code is still in development, please report to the authors any issue/bug that you may encounter. Feel free to suggest improvements to the code too.<h2><a class="anchor" name="sec_disc">
DISCLAIMER</a></h2>
This software and documentation (the "Software") were developed at the Food and Drug Administration (<b>FDA</b>) by employees of the Federal Government in the course of their official duties. Pursuant to Title 17, Section 105 of the United States Code, this work is not subject to copyright protection and is in the public domain. Permission is hereby granted, free of charge, to any person obtaining a copy of the Software, to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, or sell copies of the Software or derivatives, and to permit persons to whom the Software is furnished to do so. FDA assumes no responsibility whatsoever for use by other parties of the Software, its source code, documentation or compiled executables, and makes no guarantees, expressed or implied, about its quality, reliability, or any other characteristic. Further, use of this code in no way implies endorsement by the FDA or confers any advantage in regulatory decisions. Although this software can be redistributed and/or modified freely, we ask that any derivative works bear some notice that they are derived from it, and any modified versions bear some notice that they have been modified.<h2><a class="anchor" name="sec_Intro">
Code features</a></h2>
MC-GPU does not currently simulate the transport of electrons. The interactions between the photons and the material objects are simulated using the well-known interaction sampling models from the PENELOPE 2006 subroutine package.<p>
In order to speed up the ray-tracing of the code and minimize the access to the slow GPU main memory, the photon trajectories across the voxels are computed using the Woodcock tracking algorithm. With this technique the photons perceive the geometry as a uniform medium composed of the material of the most attenuating voxel. In this way, the voxel boundaries do not have to be explicitly calculated and multiple voxels can be crossed in a single step. To keep the simulation unbiased, some of the interactions are considered "virtual" (i.e., do not change the photon energy or direction of movement), depending on the actual energy and the material at the interaction site. In a typical simulation, several thousand threads are launched simultaneously in the GPU, each one of them simulating a batch of 10000, or more, photon tracks.<p>
The random number generator used in PENELOPE, ranecu, is also used in the GPU program. To ensure that the simulated tracks are not correlated, each thread initializes the generator to a unique position in the random sequence, far enough from the other threads, using the algorithm implemented in the seedsMLCG code.<p>
The new code is currently used in the study of scatter in x-ray imaging and includes a tally to generate radiographic images. The image is formed by counting the energy that enters a user-defined 2D grid of pixels, which is a simple approximation to a noise-free flat-panel detector with 100% detection efficiency; the pixel values have units of eV/cm^2. Four different images are reported at the end of the simulation, corresponding to the signal produced by non-scattered, single Compton, single Rayleigh, and multi-scattered photons. The radiation source is implemented as a point source emitting monoenergetic photons within a fan beam, producing a rectangular field on the detector equivalent to a collimated cone beam.<h2><a class="anchor" name="sec_CPU">
Code compilation and execution</a></h2>
MC-GPU has been tested only in the Linux operating system. A Makefile script is provided to compile the MC-GPU code in Linux. The CUDA libraries and the GNU GCC compiler must be previously installed. The Makefile may have to be edited to modify the library path.<p>
A README text file is provided with the MC-GPU source code. Read this file for more information on the code usage. An example simulation input file is also provided.<p>
MC-GPU uses CUDA to access the GPU but all the actual computations are coded in standard C code. All the CUDA specific commands are enclosed within preprocessor if statements. Defining the pre-processor variable "USING_CUDA" (i.e., compiling with "-DUSING_CUDA") the particle transport is executed in parallel in an NVIDIA GPU using CUDA. Otherwise, the code is sequentially executed in the CPU.<h2><a class="anchor" name="sec_CT">
Parallel simulation of CT scans:</a></h2>
From version 1.1, MC-GPU allows the simulation of a CT scan. The CT is simulated generating multiple projection images around the static voxelized geometry. To speed up the CT simulation, the MPI library is used to address multiple GPUs and obtain multiple projections in parallel. In order to activate the MPI code, the pre-processor variable "USING_MPI" has to be defined (ie, compiling with "-DUSING_MPI"). To use the code in parallel in N GPUs (in a single computer), the user has to run the program with N MPI threads in the CPU (eg, "mpirun -np 4 ./MC-GPU.x MC-GPU.in"). Each thread will get a unique id in the CPU (myID=0-&gt;N) and will address a unique GPU. The CT simulation will then be split so that the threads simulate consecutive projections independently, avoiding any intercommunication between threads. </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Jun 3 13:10:12 2010 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MC-GPU_v1.1.cu File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>MC-GPU_v1.1.cu File Reference</h1><code>#include &lt;<a class="el" href="MC-GPU__v1_81_8h-source.html">MC-GPU_v1.1.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html">MC-GPU_kernel_v1.1.cu</a>&gt;</code><br>

<p>
<a href="MC-GPU__v1_81_8cu-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8cu.html#3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main program to transport x rays in a 3D voxel geometry using the GPU.  <a href="#3c04138a5bfe5d72780bb7e82a18e627"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8cu.html#5cd97f26e0582ba1236d387bd8b9d2e5">read_input</a> (int argc, char **argv, int myID, unsigned long long int *total_histories, int *seed_input, int *gpu_id, int *num_threads_per_block, int *histories_per_thread, struct <a class="el" href="structdetector__struct.html">detector_struct</a> *detector_data, unsigned long long int **image_ptr, int *image_bytes, struct <a class="el" href="structsource__struct.html">source_struct</a> *source_data, char *file_name_voxels, char file_name_materials[MAX_MATERIALS][250], char *file_name_output, int *num_projections, double *D_angle, double *angularROI_0, double *angularROI_1, double *initial_angle)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the input file given in the command line and return the significant data.  <a href="#5cd97f26e0582ba1236d387bd8b9d2e5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8cu.html#96dba25b308814b25fbae71e27617f12">trim_name</a> (char *input_line, char *file_name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Extract a file name from an input text line, trimming the initial blanks, trailing comment (#) and stopping at the first blank (the file name should not contain blanks).  <a href="#96dba25b308814b25fbae71e27617f12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8cu.html#ea168bca1466813e03b649931a4f670f">fgets_trimmed</a> (char *trimmed_line, int num, FILE *file_ptr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read a line of text and trim initial blancks and trailing comments (#).  <a href="#ea168bca1466813e03b649931a4f670f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8cu.html#1daa1f1df034e2ed743ee7012e427222">load_voxels</a> (int myID, char *file_name_voxels, float *density_max, struct <a class="el" href="structvoxel__struct.html">voxel_struct</a> *voxel_data, float2 **voxel_mat_dens_ptr, unsigned int *voxel_mat_dens_bytes)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the voxel data and allocate the material and density matrix.  <a href="#1daa1f1df034e2ed743ee7012e427222"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8cu.html#55f3171a6cdb59fc43e65aa19c676d80">load_material</a> (int myID, char file_name_materials[MAX_MATERIALS][250], float *density_max, float *density_nominal, struct <a class="el" href="structlinear__interp.html">linear_interp</a> *mfp_table_data, float2 **mfp_Woodcock_table_ptr, int *mfp_Woodcock_table_bytes, float3 **mfp_table_a_ptr, float3 **mfp_table_b_ptr, int *mfp_table_bytes, struct <a class="el" href="structrayleigh__struct.html">rayleigh_struct</a> *rayleigh_table_ptr, struct <a class="el" href="structcompton__struct.html">compton_struct</a> *compton_table_ptr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the material input files and set the mean free paths and the "linear_interp" structures.  <a href="#55f3171a6cdb59fc43e65aa19c676d80"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8cu.html#39db69f5efdcc4012bddf911e8a78691">report_host</a> (char *file_name_output, struct <a class="el" href="structdetector__struct.html">detector_struct</a> *detector_data, struct <a class="el" href="structsource__struct.html">source_struct</a> *source_data, unsigned long long int *image, double time_elapsed, unsigned long long int total_histories, int current_projection, int num_projections, double D_angle, double initial_angle, int myID, int numprocs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Report the final results, from the host CPU.  <a href="#39db69f5efdcc4012bddf911e8a78691"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="MC-GPU__v1_81_8cu.html#db95164a1253ee2aafeab8a5e0a8e7e3">set_CT_trajectory</a> (int myID, int num_projections, double D_angle, double angularROI_0, double angularROI_1, struct <a class="el" href="structsource__struct.html">source_struct</a> *source_data, struct <a class="el" href="structdetector__struct.html">detector_struct</a> *detector_data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets the CT trajectory: store in memory the source and detector rotations that are needed to calculate the multiple projections.  <a href="#db95164a1253ee2aafeab8a5e0a8e7e3"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Andreu Badal (<a href="mailto:Andreu.Badal-Soler@fda.hhs.gov">Andreu.Badal-Soler@fda.hhs.gov</a>) </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>2010/05/14 -- First version: 2009/03/17 </dd></dl>

<p>Definition in file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ea168bca1466813e03b649931a4f670f"></a><!-- doxytag: member="MC&#45;GPU_v1.1.cu::fgets_trimmed" ref="ea168bca1466813e03b649931a4f670f" args="(char *trimmed_line, int num, FILE *file_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* fgets_trimmed           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>trimmed_line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>file_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read a line of text and trim initial blancks and trailing comments (#). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>num</em>&nbsp;</td><td>Characters to read </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>file_ptr</em>&nbsp;</td><td>Pointer to the input file stream </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>trimmed_line</em>&nbsp;</td><td>Trimmed line from input file, skipping empty lines and comments </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00969">969</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00542">read_input()</a>.</p>

</div>
</div><p>
<a class="anchor" name="55f3171a6cdb59fc43e65aa19c676d80"></a><!-- doxytag: member="MC&#45;GPU_v1.1.cu::load_material" ref="55f3171a6cdb59fc43e65aa19c676d80" args="(int myID, char file_name_materials[MAX_MATERIALS][250], float *density_max, float *density_nominal, struct linear_interp *mfp_table_data, float2 **mfp_Woodcock_table_ptr, int *mfp_Woodcock_table_bytes, float3 **mfp_table_a_ptr, float3 **mfp_table_b_ptr, int *mfp_table_bytes, struct rayleigh_struct *rayleigh_table_ptr, struct compton_struct *compton_table_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void load_material           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>file_name_materials</em>[MAX_MATERIALS][250], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>density_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>density_nominal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlinear__interp.html">linear_interp</a> *&nbsp;</td>
          <td class="paramname"> <em>mfp_table_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float2 **&nbsp;</td>
          <td class="paramname"> <em>mfp_Woodcock_table_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>mfp_Woodcock_table_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 **&nbsp;</td>
          <td class="paramname"> <em>mfp_table_a_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float3 **&nbsp;</td>
          <td class="paramname"> <em>mfp_table_b_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>mfp_table_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structrayleigh__struct.html">rayleigh_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>rayleigh_table_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcompton__struct.html">compton_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>compton_table_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read the material input files and set the mean free paths and the "linear_interp" structures. 
<p>
Find the material nominal density. Set the Woodcock trick data.<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>file_name_materials</em>&nbsp;</td><td>Array with the names of the material files. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>density_max</em>&nbsp;</td><td>maximum density in the geometry (needed to set Woodcock trick) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>density_nominal</em>&nbsp;</td><td>Array with the nominal density of the materials read </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>mfp_table_data</em>&nbsp;</td><td>Constant values for the linear interpolation </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>mfp_table_a_ptr</em>&nbsp;</td><td>First element for the linear interpolation. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>mfp_table_b_ptr</em>&nbsp;</td><td>Second element for the linear interpolation. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01166">1166</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::aco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::bco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00189">linear_interp::e0</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00201">compton_struct::fco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00201">compton_struct::fj0</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00189">linear_interp::ide</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00219">rayleigh_struct::itlco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00219">rayleigh_struct::ituco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00054">MASTER_THREAD</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00204">compton_struct::noscco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00188">linear_interp::num_values</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::pco</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::pmax</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00201">compton_struct::uico</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00214">rayleigh_struct::xco</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="1daa1f1df034e2ed743ee7012e427222"></a><!-- doxytag: member="MC&#45;GPU_v1.1.cu::load_voxels" ref="1daa1f1df034e2ed743ee7012e427222" args="(int myID, char *file_name_voxels, float *density_max, struct voxel_struct *voxel_data, float2 **voxel_mat_dens_ptr, unsigned int *voxel_mat_dens_bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void load_voxels           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name_voxels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>density_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structvoxel__struct.html">voxel_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>voxel_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float2 **&nbsp;</td>
          <td class="paramname"> <em>voxel_mat_dens_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>voxel_mat_dens_bytes</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read the voxel data and allocate the material and density matrix. 
<p>
Also find and report the maximum density defined in the geometry.<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>file_name_voxels</em>&nbsp;</td><td>Name of the voxelized geometry file. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>density_max</em>&nbsp;</td><td>Array with the maximum density for each material in the voxels. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>voxel_data</em>&nbsp;</td><td>Pointer to a structure containing the voxel number and size. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>voxel_mat_dens_ptr</em>&nbsp;</td><td>Pointer to the vector with the voxel materials and densities. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01029">1029</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00176">voxel_struct::inv_voxel_size</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00054">MASTER_THREAD</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00060">MAX_MATERIALS</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00175">voxel_struct::num_voxels</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00176">voxel_struct::size_bbox</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3c04138a5bfe5d72780bb7e82a18e627"></a><!-- doxytag: member="MC&#45;GPU_v1.1.cu::main" ref="3c04138a5bfe5d72780bb7e82a18e627" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Main program to transport x rays in a 3D voxel geometry using the GPU. 
<p>
This function reads the description of the simulation from an external file given in the command line. This input file defines the number of particles to simulate, the characteristics of the x-ray source and the detector, the number and spacing of the projections (if simulating a CT), the location of the material files containing the interaction mean free paths, and the location of the voxelized geometry file.<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Andreu Badal </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>2010/03/19 </dd></dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">170</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00156">detector_struct::corner_min_rotated_to_Y</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::cos_theta_low</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::D_phi</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00268">detector_data_CONST</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::direction</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00189">linear_interp::e0</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::energy</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00189">linear_interp::ide</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00059">init_image_array_GPU()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_X</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_Z</a>, <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01166">load_material()</a>, <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01029">load_voxels()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00054">MASTER_THREAD</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00060">MAX_MATERIALS</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00274">mfp_table_data_CONST</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00162">detector_struct::num_pixels</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00188">linear_interp::num_values</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::position</a>, <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00542">read_input()</a>, <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01543">report_host()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00155">detector_struct::sdd</a>, <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01650">set_CT_trajectory()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00262">source_data_CONST</a>, <a class="el" href="MC-GPU__kernel__v1_81_8cu-source.html#l00111">track_particles()</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00256">voxel_data_CONST</a>.</p>

</div>
</div><p>
<a class="anchor" name="5cd97f26e0582ba1236d387bd8b9d2e5"></a><!-- doxytag: member="MC&#45;GPU_v1.1.cu::read_input" ref="5cd97f26e0582ba1236d387bd8b9d2e5" args="(int argc, char **argv, int myID, unsigned long long int *total_histories, int *seed_input, int *gpu_id, int *num_threads_per_block, int *histories_per_thread, struct detector_struct *detector_data, unsigned long long int **image_ptr, int *image_bytes, struct source_struct *source_data, char *file_name_voxels, char file_name_materials[MAX_MATERIALS][250], char *file_name_output, int *num_projections, double *D_angle, double *angularROI_0, double *angularROI_1, double *initial_angle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_input           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int *&nbsp;</td>
          <td class="paramname"> <em>total_histories</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>seed_input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>gpu_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>num_threads_per_block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>histories_per_thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdetector__struct.html">detector_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>detector_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int **&nbsp;</td>
          <td class="paramname"> <em>image_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>image_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsource__struct.html">source_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>source_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name_voxels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>file_name_materials</em>[MAX_MATERIALS][250], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name_output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>num_projections</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>D_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>angularROI_0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>angularROI_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>initial_angle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read the input file given in the command line and return the significant data. 
<p>
Example input file:<p>
1000000 [Total number of histories to simulate] geometry.vox [Voxelized geometry file name] material.mat [Material data file name]<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>argc</em>&nbsp;</td><td>Command line parameters </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>argv</em>&nbsp;</td><td>Command line parameters: name opf input file </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>total_histories</em>&nbsp;</td><td>Total number of particles to simulate </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>seed_input</em>&nbsp;</td><td>Input random number generator seed </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>num_threads_per_block</em>&nbsp;</td><td>Number of CUDA threads for each GPU block </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>detector_data</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>image</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>source_data</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>file_name_voxels</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>file_name_materials</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>file_name_output</em>&nbsp;</td><td></td></tr>
  </table>
</dl>

<p>
!DeBuG!! Force square field for any phi!! 
<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00542">542</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00156">detector_struct::corner_min_rotated_to_Y</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::cos_theta_low</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::D_cos_theta</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::D_phi</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::direction</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::energy</a>, <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00969">fgets_trimmed()</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::height_Z</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_X</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_Z</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00054">MASTER_THREAD</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::max_height_at_y1cm</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00162">detector_struct::num_pixels</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::phi_low</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::position</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::rot_fan</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::rot_inv</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00163">detector_struct::rotation_flag</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00155">detector_struct::sdd</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00163">detector_struct::total_num_pixels</a>, <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00941">trim_name()</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::width_X</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="39db69f5efdcc4012bddf911e8a78691"></a><!-- doxytag: member="MC&#45;GPU_v1.1.cu::report_host" ref="39db69f5efdcc4012bddf911e8a78691" args="(char *file_name_output, struct detector_struct *detector_data, struct source_struct *source_data, unsigned long long int *image, double time_elapsed, unsigned long long int total_histories, int current_projection, int num_projections, double D_angle, double initial_angle, int myID, int numprocs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int report_host           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name_output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdetector__struct.html">detector_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>detector_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsource__struct.html">source_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>source_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int *&nbsp;</td>
          <td class="paramname"> <em>image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>time_elapsed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long int&nbsp;</td>
          <td class="paramname"> <em>total_histories</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>current_projection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num_projections</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>D_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>initial_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numprocs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Report the final results, from the host CPU. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>file_name_output</em>&nbsp;</td><td>File where tallied image is reported </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>detector_data</em>&nbsp;</td><td>Detector description read from the input file (pointer to <a class="el" href="structdetector__struct.html" title="Structure storing the data defining the x-ray detector.">detector_struct</a>) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>image</em>&nbsp;</td><td>Tallied image (in meV per pixel) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>time_elapsed</em>&nbsp;</td><td>Time elapsed during the main loop execution (in seconds) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>total_histories</em>&nbsp;</td><td>Total number of x-rays simulated </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01543">1543</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::energy</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_X</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::inv_pixel_size_Z</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00162">detector_struct::num_pixels</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00073">SCALE_eV</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="db95164a1253ee2aafeab8a5e0a8e7e3"></a><!-- doxytag: member="MC&#45;GPU_v1.1.cu::set_CT_trajectory" ref="db95164a1253ee2aafeab8a5e0a8e7e3" args="(int myID, int num_projections, double D_angle, double angularROI_0, double angularROI_1, struct source_struct *source_data, struct detector_struct *detector_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_CT_trajectory           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>myID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num_projections</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>D_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>angularROI_0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>angularROI_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsource__struct.html">source_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>source_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdetector__struct.html">detector_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>detector_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sets the CT trajectory: store in memory the source and detector rotations that are needed to calculate the multiple projections. 
<p>
The first projection (0) was previously initialized in function "read_input".<p>
ASSUMPTIONS: the CT scan plane must be perpendicular to the Z axis, ie, the initial direction of the particles must have w=0! 
<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l01650">1650</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>References <a class="el" href="MC-GPU__v1_81_8h-source.html#l00156">detector_struct::corner_min_rotated_to_Y</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::direction</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::height_Z</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00054">MASTER_THREAD</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00133">source_struct::position</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00135">source_struct::rot_fan</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::rot_inv</a>, <a class="el" href="MC-GPU__v1_81_8h-source.html#l00155">detector_struct::sdd</a>, and <a class="el" href="MC-GPU__v1_81_8h-source.html#l00157">detector_struct::width_X</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00170">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="96dba25b308814b25fbae71e27617f12"></a><!-- doxytag: member="MC&#45;GPU_v1.1.cu::trim_name" ref="96dba25b308814b25fbae71e27617f12" args="(char *input_line, char *file_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void trim_name           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>input_line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Extract a file name from an input text line, trimming the initial blanks, trailing comment (#) and stopping at the first blank (the file name should not contain blanks). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>input_line</em>&nbsp;</td><td>Input sentence with blanks and a trailing comment </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>file_name</em>&nbsp;</td><td>Trimmed file name </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00941">941</a> of file <a class="el" href="MC-GPU__v1_81_8cu-source.html">MC-GPU_v1.1.cu</a>.</p>

<p>Referenced by <a class="el" href="MC-GPU__v1_81_8cu-source.html#l00542">read_input()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Jun 3 13:10:12 2010 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>

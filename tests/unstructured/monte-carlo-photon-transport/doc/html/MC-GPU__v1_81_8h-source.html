<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MC-GPU_v1.1.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>MC-GPU_v1.1.h</h1><a href="MC-GPU__v1_81_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment"></span>
<a name="l00002"></a>00002 <span class="comment">////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00003"></a>00003 <span class="comment"></span><span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">//              ****************************</span>
<a name="l00005"></a>00005 <span class="comment">//              *** MC-GPU , version 1.1 ***</span>
<a name="l00006"></a>00006 <span class="comment">//              ****************************</span>
<a name="l00007"></a>00007 <span class="comment">//                                          </span><span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">//!   Header file containing the declarations for the MC-GPU code.</span>
<a name="l00009"></a>00009 <span class="comment">//!   This file declares all the host and device functions and structures,</span>
<a name="l00010"></a>00010 <span class="comment">//!   the library files to include in the compilation, various constants parameters</span>
<a name="l00011"></a>00011 <span class="comment">//!   of the simulation, pre-processor macro functions, etc.</span>
<a name="l00012"></a>00012 <span class="comment"></span><span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">//</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//          ** DISCLAIMER **</span>
<a name="l00016"></a>00016 <span class="comment">//</span>
<a name="l00017"></a>00017 <span class="comment">// This software and documentation (the "Software") were developed at the Food and</span>
<a name="l00018"></a>00018 <span class="comment">// Drug Administration (FDA) by employees of the Federal Government in the course</span>
<a name="l00019"></a>00019 <span class="comment">// of their official duties. Pursuant to Title 17, Section 105 of the United States</span>
<a name="l00020"></a>00020 <span class="comment">// Code, this work is not subject to copyright protection and is in the public</span>
<a name="l00021"></a>00021 <span class="comment">// domain. Permission is hereby granted, free of charge, to any person obtaining a</span>
<a name="l00022"></a>00022 <span class="comment">// copy of the Software, to deal in the Software without restriction, including</span>
<a name="l00023"></a>00023 <span class="comment">// without limitation the rights to use, copy, modify, merge, publish, distribute,</span>
<a name="l00024"></a>00024 <span class="comment">// sublicense, or sell copies of the Software or derivatives, and to permit persons</span>
<a name="l00025"></a>00025 <span class="comment">// to whom the Software is furnished to do so. FDA assumes no responsibility</span>
<a name="l00026"></a>00026 <span class="comment">// whatsoever for use by other parties of the Software, its source code,</span>
<a name="l00027"></a>00027 <span class="comment">// documentation or compiled executables, and makes no guarantees, expressed or</span>
<a name="l00028"></a>00028 <span class="comment">// implied, about its quality, reliability, or any other characteristic. Further,</span>
<a name="l00029"></a>00029 <span class="comment">// use of this code in no way implies endorsement by the FDA or confers any</span>
<a name="l00030"></a>00030 <span class="comment">// advantage in regulatory decisions.  Although this software can be redistributed</span>
<a name="l00031"></a>00031 <span class="comment">// and/or modified freely, we ask that any derivative works bear some notice that</span>
<a name="l00032"></a>00032 <span class="comment">// they are derived from it, and any modified versions bear some notice that they</span>
<a name="l00033"></a>00033 <span class="comment">// have been modified.</span>
<a name="l00034"></a>00034 <span class="comment">//                                                                            </span>
<a name="l00035"></a>00035 <span class="comment">//</span><span class="comment"></span>
<a name="l00036"></a>00036 <span class="comment">//!                     @file    MC-GPU_v1.1.h</span>
<a name="l00037"></a>00037 <span class="comment">//!                     @author  Andreu Badal (Andreu.Badal-Soler@fda.hhs.gov)</span>
<a name="l00038"></a>00038 <span class="comment">//!                     @date    2010/05/14</span>
<a name="l00039"></a>00039 <span class="comment"></span><span class="comment">//</span><span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#ifndef MCGPU_H_</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#define MCGPU_H_</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="comment">// *** To use CUDA, compile with "-DUSING_CUDA" or uncomment the following line:</span>
<a name="l00047"></a>00047 <span class="comment">//#define USING_CUDA</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">// *** To use MPI to simulate multiple CT projections in different GPUs compile with "-DUSING_MPI" or uncomment the following line:</span>
<a name="l00050"></a>00050 <span class="comment">//#define USING_CUDA</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment"></span>
<a name="l00053"></a>00053 <span class="comment">//! MPI macro: mark commands to be executed only by the master thread (myID==0).</span>
<a name="l00054"></a><a class="code" href="MC-GPU__v1_81_8h.html#155f8b8dae8b676fc50d93a287c4e6df">00054</a> <span class="comment"></span><span class="preprocessor">#define MASTER_THREAD if(0==myID)</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00056"></a>00056 <span class="comment">//! Maximum number of projections allowed in the CT simulation (limited by the constant memory size):</span>
<a name="l00057"></a><a class="code" href="MC-GPU__v1_81_8h.html#30b26edf408e1ff6034eb712ab7e173e">00057</a> <span class="comment"></span><span class="preprocessor">#define  MAX_NUM_PROJECTIONS  540</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00059"></a>00059 <span class="comment">//! Constants values for the Compton and Rayleigh models:</span>
<a name="l00060"></a><a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15">00060</a> <span class="comment"></span><span class="preprocessor">#define  MAX_MATERIALS       9</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#define  MAX_SHELLS         30</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#define  MAX_ENERGYBINS  45005</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor">#define  NP_RAYLEIGH       128</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00065"></a>00065 <span class="preprocessor">#define  PI      3.14159265358979323846</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#define  RAD2DEG 180.0/PI</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#define  DEG2RAD PI/180.0</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>
<a name="l00069"></a>00069 <span class="comment">// Other constants used in the code:</span><span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">//! Value to scale the deposited energy in the pixels so that it can be stored as a long long integer</span>
<a name="l00071"></a>00071 <span class="comment">//! instead of a double precision float. The integer values have to be used in order to use the</span>
<a name="l00072"></a>00072 <span class="comment">//! atomicAdd function in CUDA.</span>
<a name="l00073"></a><a class="code" href="MC-GPU__v1_81_8h.html#c0c03cf5e803404f5dc2a42467395a3a">00073</a> <span class="comment"></span><span class="preprocessor">#define SCALE_eV        10000.0f</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#define EPS_SOURCE      0.000020f</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">#define NEG_EPS_SOURCE -0.000020f</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor">#define INF             500000.0f</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor">#define INF_minus1      499999.0f</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#define NEG_INF        -500000.0f</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00080"></a>00080 <span class="comment">//! Preprocessor macro to calculate maximum and minimum values:</span>
<a name="l00081"></a><a class="code" href="MC-GPU__v1_81_8h.html#1b7b63b09e6ac252980467701bd80cb7">00081</a> <span class="comment"></span><span class="preprocessor">#define max_value( a, b ) ( ((a) &gt; (b)) ? (a) : (b) )</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="preprocessor">#define min_value( a, b ) ( ((a) &lt; (b)) ? (a) : (b) )</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">// Include standard header files:</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00089"></a>00089 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00090"></a>00090 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="preprocessor">#ifndef _GNU_SOURCE</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span><span class="comment">// This definition may be required to use the "sincos" function from math.h  !!DeBuG!!</span>
<a name="l00094"></a>00094 <span class="preprocessor">#define _GNU_SOURCE</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span><span class="comment">// Include CUDA functions:</span>
<a name="l00100"></a>00100 <span class="preprocessor">#include &lt;cutil_inline.h&gt;</span>
<a name="l00101"></a>00101 <span class="preprocessor">#endif</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a>00103 <span class="preprocessor">#ifdef USING_MPI</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span><span class="comment">// Include MPI functions:</span>
<a name="l00105"></a>00105 <span class="preprocessor">#include &lt;mpi.h&gt;</span>
<a name="l00106"></a>00106 <span class="preprocessor">#endif</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>
<a name="l00108"></a>00108 <span class="comment">// Include the definition of the vector files (float3, int2...) that are useful in the GPU (multiple values can be read simultaneously from the slow main memory):</span>
<a name="l00109"></a>00109 <span class="preprocessor">#include &lt;vector_types.h&gt;</span>
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="comment">// Useful struct no defined in "vector_types":</span>
<a name="l00112"></a>00112 <span class="keyword">struct</span>
<a name="l00113"></a>00113 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>  __builtin_align__(16)
<a name="l00115"></a>00115 <span class="preprocessor">#endif</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>double3
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118   <span class="keywordtype">double</span> x, y, z;
<a name="l00119"></a>00119 };
<a name="l00120"></a>00120 <span class="keyword">typedef</span> <span class="keyword">struct </span>double3 double3;   <span class="comment">// DEFINE DATA TYPE</span>
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="comment">// MC-GPU structure declarations:</span>
<a name="l00124"></a>00124 <span class="comment"></span>
<a name="l00125"></a>00125 <span class="comment">//! Structure storing the data defining the source model.</span>
<a name="l00126"></a>00126 <span class="comment">//! When a CT is simulated, multiple sources will be stored, one for each projection angle. </span>
<a name="l00127"></a><a class="code" href="structsource__struct.html">00127</a> <span class="comment"></span><span class="keyword">struct</span>
<a name="l00128"></a>00128 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>  __align__(16)
<a name="l00130"></a>00130 <span class="preprocessor">#endif</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span><a class="code" href="structsource__struct.html" title="Structure storing the data defining the source model.">source_struct</a>       <span class="comment">// Define a cone beam x-ray source.</span>
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133   float3 position[<a class="code" href="MC-GPU__v1_81_8h.html#30b26edf408e1ff6034eb712ab7e173e" title="Maximum number of projections allowed in the CT simulation (limited by the constant...">MAX_NUM_PROJECTIONS</a>],
<a name="l00134"></a>00134          direction[<a class="code" href="MC-GPU__v1_81_8h.html#30b26edf408e1ff6034eb712ab7e173e" title="Maximum number of projections allowed in the CT simulation (limited by the constant...">MAX_NUM_PROJECTIONS</a>];
<a name="l00135"></a>00135   <span class="keywordtype">float</span> rot_fan[<a class="code" href="MC-GPU__v1_81_8h.html#30b26edf408e1ff6034eb712ab7e173e" title="Maximum number of projections allowed in the CT simulation (limited by the constant...">MAX_NUM_PROJECTIONS</a>][9],   <span class="comment">// Rotation defined by the initial source direction (needed by the fan beam source; its inverse is used by the detector).</span>
<a name="l00136"></a>00136         energy,
<a name="l00137"></a>00137         cos_theta_low,    <span class="comment">// Angles for the fan beam model (pyramidal source).</span>
<a name="l00138"></a>00138         phi_low,
<a name="l00139"></a>00139         D_cos_theta,
<a name="l00140"></a>00140         D_phi,
<a name="l00141"></a>00141         max_height_at_y1cm;  
<a name="l00142"></a>00142 };
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="comment"></span>
<a name="l00145"></a>00145 <span class="comment">//! Structure storing the data defining the x-ray detector.</span>
<a name="l00146"></a>00146 <span class="comment">//! For a CT, the struct stores for each angle the detector location and the rotations to</span>
<a name="l00147"></a>00147 <span class="comment">//! transport the detector to a plane perpendicular to +Y.</span>
<a name="l00148"></a><a class="code" href="structdetector__struct.html">00148</a> <span class="comment"></span><span class="keyword">struct</span>
<a name="l00149"></a>00149 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>  __align__(16)
<a name="l00151"></a>00151 <span class="preprocessor">#endif</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span><a class="code" href="structdetector__struct.html" title="Structure storing the data defining the x-ray detector.">detector_struct</a>         <span class="comment">// Define a 2D detector plane, located in front of the defined source (centered at the focal spot and perpendicular to the initial direction).</span>
<a name="l00153"></a>00153 {                       <span class="comment">// The radiograohic image will be stored in the global variable "unsigned long long int *image".</span>
<a name="l00154"></a>00154   <span class="comment">// float3 center[MAX_NUM_PROJECTIONS],</span>
<a name="l00155"></a>00155   <span class="keywordtype">float</span> sdd;                                <span class="comment">// Store the source-detector distance</span>
<a name="l00156"></a>00156   float3 corner_min_rotated_to_Y[<a class="code" href="MC-GPU__v1_81_8h.html#30b26edf408e1ff6034eb712ab7e173e" title="Maximum number of projections allowed in the CT simulation (limited by the constant...">MAX_NUM_PROJECTIONS</a>];
<a name="l00157"></a>00157   <span class="keywordtype">float</span> rot_inv[<a class="code" href="MC-GPU__v1_81_8h.html#30b26edf408e1ff6034eb712ab7e173e" title="Maximum number of projections allowed in the CT simulation (limited by the constant...">MAX_NUM_PROJECTIONS</a>][9],    <span class="comment">// Rotation to transport a particle on the detector plane to a frame where the detector is perpendicular to +Y.</span>
<a name="l00158"></a>00158         width_X,
<a name="l00159"></a>00159         height_Z,
<a name="l00160"></a>00160         inv_pixel_size_X,
<a name="l00161"></a>00161         inv_pixel_size_Z;
<a name="l00162"></a>00162   int2 num_pixels;
<a name="l00163"></a>00163   <span class="keywordtype">int</span> total_num_pixels,
<a name="l00164"></a>00164       rotation_flag;    <span class="comment">// Flag &gt;0 if the initial source direction is not (0,1,0); ==0 otherwise (ie, detector perpendicular to +Y axis and rotation not required).</span>
<a name="l00165"></a>00165 };
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="comment"></span>
<a name="l00168"></a>00168 <span class="comment">//! Structure defining a voxelized box with the back-lower corner at the coordinate origin.</span>
<a name="l00169"></a><a class="code" href="structvoxel__struct.html">00169</a> <span class="comment"></span><span class="keyword">struct</span>
<a name="l00170"></a>00170 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>  __align__(16)
<a name="l00172"></a>00172 <span class="preprocessor">#endif</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span><a class="code" href="structvoxel__struct.html" title="Structure defining a voxelized box with the back-lower corner at the coordinate origin...">voxel_struct</a>        <span class="comment">// Define a voxelized box with the back-lower corner at the coordinate origin.</span>
<a name="l00174"></a>00174 {                                        <span class="comment">// Voxel material and densities are stored in a local variable</span>
<a name="l00175"></a>00175   int3 num_voxels;
<a name="l00176"></a>00176   float3 inv_voxel_size,
<a name="l00177"></a>00177          size_bbox;
<a name="l00178"></a>00178 };
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="comment"></span>
<a name="l00181"></a>00181 <span class="comment">//! Structure with the basic data required by the linear interpolation of the mean free paths: number of values and energy grid.</span>
<a name="l00182"></a><a class="code" href="structlinear__interp.html">00182</a> <span class="comment"></span><span class="keyword">struct</span>
<a name="l00183"></a>00183 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00184"></a>00184 <span class="preprocessor"></span>  __align__(16)
<a name="l00185"></a>00185 <span class="preprocessor">#endif</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span><a class="code" href="structlinear__interp.html" title="Structure with the basic data required by the linear interpolation of the mean free...">linear_interp</a>       <span class="comment">// Constant data for linear interpolation of mean free paths</span>
<a name="l00187"></a>00187 {                                        <span class="comment">// The parameters 'a' and 'b' are stored in local variables float4 *a, *b;</span>
<a name="l00188"></a>00188   <span class="keywordtype">int</span> num_values;      <span class="comment">// --&gt;  Number of iterpolation points (eg, 2^12 = 4096).</span>
<a name="l00189"></a>00189   <span class="keywordtype">float</span> e0,            <span class="comment">// --&gt; Minimum energy</span>
<a name="l00190"></a>00190         ide;           <span class="comment">// --&gt; Inverse of the energy bin width</span>
<a name="l00191"></a>00191 };
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment"></span>
<a name="l00194"></a>00194 <span class="comment">//! Structure storing the data of the Compton interaction sampling model (equivalent to PENELOPE's common block /CGCO/).</span>
<a name="l00195"></a><a class="code" href="structcompton__struct.html">00195</a> <span class="comment"></span><span class="keyword">struct</span>
<a name="l00196"></a>00196 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>  __align__(16)
<a name="l00198"></a>00198 <span class="preprocessor">#endif</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span><a class="code" href="structcompton__struct.html" title="Structure storing the data of the Compton interaction sampling model (equivalent...">compton_struct</a>      <span class="comment">// Data from PENELOPE's common block CGCO: Compton interaction data</span>
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201   <span class="keywordtype">float</span> fco[<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>*MAX_SHELLS],
<a name="l00202"></a>00202         uico[<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>*MAX_SHELLS],
<a name="l00203"></a>00203         fj0[<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>*MAX_SHELLS];
<a name="l00204"></a>00204   <span class="keywordtype">int</span> noscco[<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>];
<a name="l00205"></a>00205 };
<a name="l00206"></a>00206 <span class="comment"></span>
<a name="l00207"></a>00207 <span class="comment">//! Structure storing the data of the Rayleigh interaction sampling model (equivalent to PENELOPE's common block /CGRA/).</span>
<a name="l00208"></a><a class="code" href="structrayleigh__struct.html">00208</a> <span class="comment"></span><span class="keyword">struct</span>
<a name="l00209"></a>00209 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span>  __align__(16)
<a name="l00211"></a>00211 <span class="preprocessor">#endif</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span><a class="code" href="structrayleigh__struct.html" title="Structure storing the data of the Rayleigh interaction sampling model (equivalent...">rayleigh_struct</a>
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214   <span class="keywordtype">float</span> xco[NP_RAYLEIGH*<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>],
<a name="l00215"></a>00215         pco[NP_RAYLEIGH*<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>],
<a name="l00216"></a>00216         aco[NP_RAYLEIGH*<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>],
<a name="l00217"></a>00217         bco[NP_RAYLEIGH*<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>],
<a name="l00218"></a>00218         pmax[MAX_ENERGYBINS*<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>];
<a name="l00219"></a>00219   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> itlco[NP_RAYLEIGH*<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>],
<a name="l00220"></a>00220                 ituco[NP_RAYLEIGH*<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>];
<a name="l00221"></a>00221 };
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 <span class="comment"></span>
<a name="l00225"></a>00225 <span class="comment">//// *** HOST FUNCTIONS *** ////</span>
<a name="l00226"></a>00226 <span class="comment"></span>
<a name="l00227"></a>00227 <span class="keywordtype">void</span> <a class="code" href="MC-GPU__v1_81_8cu.html#5cd97f26e0582ba1236d387bd8b9d2e5" title="Read the input file given in the command line and return the significant data.">read_input</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv, <span class="keywordtype">int</span> myID, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>* total_histories, <span class="keywordtype">int</span>* gpu_id, <span class="keywordtype">int</span>* seed_input, <span class="keywordtype">int</span>* num_threads_per_block, <span class="keywordtype">int</span>* histories_per_thread, <span class="keyword">struct</span> <a class="code" href="structdetector__struct.html" title="Structure storing the data defining the x-ray detector.">detector_struct</a>* detector_data, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>** image_ptr, <span class="keywordtype">int</span>* image_bytes, <span class="keyword">struct</span> <a class="code" href="structsource__struct.html" title="Structure storing the data defining the source model.">source_struct</a>* source_data, <span class="keywordtype">char</span>* file_name_voxels, <span class="keywordtype">char</span> file_name_materials[<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>][250], <span class="keywordtype">char</span>* file_name_output, <span class="keywordtype">int</span>* num_projections, <span class="keywordtype">double</span>* D_angle, <span class="keywordtype">double</span>* angularROI_0, <span class="keywordtype">double</span>* angularROI_1, <span class="keywordtype">double</span>* initial_angle);
<a name="l00228"></a>00228 <span class="keywordtype">void</span> <a class="code" href="MC-GPU__v1_81_8cu.html#1daa1f1df034e2ed743ee7012e427222" title="Read the voxel data and allocate the material and density matrix.">load_voxels</a>(<span class="keywordtype">int</span> myID, <span class="keywordtype">char</span>* file_name_voxels, <span class="keywordtype">float</span>* density_max, <span class="keyword">struct</span> <a class="code" href="structvoxel__struct.html" title="Structure defining a voxelized box with the back-lower corner at the coordinate origin...">voxel_struct</a>* voxel_data, float2** voxel_mat_dens_ptr, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* voxel_mat_dens_bytes);
<a name="l00229"></a>00229 <span class="keywordtype">void</span> <a class="code" href="MC-GPU__v1_81_8cu.html#55f3171a6cdb59fc43e65aa19c676d80" title="Read the material input files and set the mean free paths and the &amp;quot;linear_interp&amp;quot;...">load_material</a>(<span class="keywordtype">int</span> myID, <span class="keywordtype">char</span> file_name_materials[<a class="code" href="MC-GPU__v1_81_8h.html#7aa308231ff3dcfd43ac19023e2e6e15" title="Constants values for the Compton and Rayleigh models:.">MAX_MATERIALS</a>][250], <span class="keywordtype">float</span>* density_max, <span class="keywordtype">float</span>* density_nominal, <span class="keyword">struct</span> <a class="code" href="structlinear__interp.html" title="Structure with the basic data required by the linear interpolation of the mean free...">linear_interp</a>* mfp_table_data, float2** mfp_Woodcock_table, <span class="keywordtype">int</span>* mfp_Woodcock_table_bytes, float3** mfp_table_a_ptr, float3** mfp_table_b_ptr, <span class="keywordtype">int</span>* mfp_table_bytes, <span class="keyword">struct</span> <a class="code" href="structrayleigh__struct.html" title="Structure storing the data of the Rayleigh interaction sampling model (equivalent...">rayleigh_struct</a> *rayleigh_table_ptr, <span class="keyword">struct</span> <a class="code" href="structcompton__struct.html" title="Structure storing the data of the Compton interaction sampling model (equivalent...">compton_struct</a> *compton_table_ptr);
<a name="l00230"></a>00230 <span class="keywordtype">void</span> <a class="code" href="MC-GPU__v1_81_8cu.html#96dba25b308814b25fbae71e27617f12" title="Extract a file name from an input text line, trimming the initial blanks, trailing...">trim_name</a>(<span class="keywordtype">char</span>* input_line, <span class="keywordtype">char</span>* file_name);
<a name="l00231"></a>00231 <span class="keywordtype">char</span>* <a class="code" href="MC-GPU__v1_81_8cu.html#ea168bca1466813e03b649931a4f670f" title="Read a line of text and trim initial blancks and trailing comments (#).">fgets_trimmed</a>(<span class="keywordtype">char</span>* trimmed_line, <span class="keywordtype">int</span> num, FILE* file_ptr);
<a name="l00232"></a>00232 <span class="keywordtype">int</span> <a class="code" href="MC-GPU__v1_81_8cu.html#39db69f5efdcc4012bddf911e8a78691" title="Report the final results, from the host CPU.">report_host</a>(<span class="keywordtype">char</span>* file_name_output, <span class="keyword">struct</span> <a class="code" href="structdetector__struct.html" title="Structure storing the data defining the x-ray detector.">detector_struct</a>* detector_data, <span class="keyword">struct</span> <a class="code" href="structsource__struct.html" title="Structure storing the data defining the source model.">source_struct</a>* source_data, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>* image, <span class="keywordtype">double</span> time_elapsed, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> total_histories, <span class="keywordtype">int</span> current_projection, <span class="keywordtype">int</span> num_projections, <span class="keywordtype">double</span> D_angle, <span class="keywordtype">double</span> initial_angle, <span class="keywordtype">int</span> myID, <span class="keywordtype">int</span> numprocs);
<a name="l00233"></a>00233 <span class="keywordtype">void</span> <a class="code" href="MC-GPU__v1_81_8cu.html#db95164a1253ee2aafeab8a5e0a8e7e3" title="Sets the CT trajectory: store in memory the source and detector rotations that are...">set_CT_trajectory</a>(<span class="keywordtype">int</span> myID, <span class="keywordtype">int</span> num_projections, <span class="keywordtype">double</span> D_angle, <span class="keywordtype">double</span> angularROI_0, <span class="keywordtype">double</span> angularROI_1, <span class="keyword">struct</span> <a class="code" href="structsource__struct.html" title="Structure storing the data defining the source model.">source_struct</a>* source_data, <span class="keyword">struct</span> <a class="code" href="structdetector__struct.html" title="Structure storing the data defining the x-ray detector.">detector_struct</a>* detector_data);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span><span class="keywordtype">void</span> init_CUDA_device( <span class="keywordtype">int</span>* gpu_id, <span class="keywordtype">int</span> myID,
<a name="l00237"></a>00237       <span class="comment">/*Variables to GPU constant memory:*/</span> <span class="keyword">struct</span> <a class="code" href="structvoxel__struct.html" title="Structure defining a voxelized box with the back-lower corner at the coordinate origin...">voxel_struct</a>* voxel_data, <span class="keyword">struct</span> <a class="code" href="structsource__struct.html" title="Structure storing the data defining the source model.">source_struct</a>* source_data, <span class="keyword">struct</span> <a class="code" href="structdetector__struct.html" title="Structure storing the data defining the x-ray detector.">detector_struct</a>* detector_data, <span class="keyword">struct</span> <a class="code" href="structlinear__interp.html" title="Structure with the basic data required by the linear interpolation of the mean free...">linear_interp</a>* mfp_table_data,
<a name="l00238"></a>00238       <span class="comment">/*Variables to GPU global memory:*/</span> float2* voxel_mat_dens, float2** voxel_mat_dens_device, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> voxel_mat_dens_bytes,
<a name="l00239"></a>00239         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>* image, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>** image_device, <span class="keywordtype">int</span> image_bytes,
<a name="l00240"></a>00240         float2* mfp_Woodcock_table, float2** mfp_Woodcock_table_device, <span class="keywordtype">int</span> mfp_Woodcock_table_bytes,
<a name="l00241"></a>00241         float3* mfp_table_a, float3* mfp_table_b, float3** mfp_table_a_device, float3** mfp_table_b_device, <span class="keywordtype">int</span> mfp_table_bytes,
<a name="l00242"></a>00242         <span class="keyword">struct</span> <a class="code" href="structrayleigh__struct.html" title="Structure storing the data of the Rayleigh interaction sampling model (equivalent...">rayleigh_struct</a>* rayleigh_table, <span class="keyword">struct</span> <a class="code" href="structrayleigh__struct.html" title="Structure storing the data of the Rayleigh interaction sampling model (equivalent...">rayleigh_struct</a>** rayleigh_table_device,
<a name="l00243"></a>00243         <span class="keyword">struct</span> <a class="code" href="structcompton__struct.html" title="Structure storing the data of the Compton interaction sampling model (equivalent...">compton_struct</a>* compton_table, <span class="keyword">struct</span> <a class="code" href="structcompton__struct.html" title="Structure storing the data of the Compton interaction sampling model (equivalent...">compton_struct</a>** compton_table_device );
<a name="l00244"></a>00244 <span class="preprocessor">#endif</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span>
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="comment"></span>
<a name="l00248"></a>00248 <span class="comment">//// *** DEVICE CONSTANT MEMORY DECLARATION (~global variables in the GPU) *** ////</span>
<a name="l00249"></a>00249 <span class="comment"></span>
<a name="l00250"></a>00250 <span class="comment">// -- Constant memory (defined as global variables):</span>
<a name="l00251"></a>00251 <span class="comment"></span>
<a name="l00252"></a>00252 <span class="comment">//! Global variable to be stored in the GPU constant memory defining the size of the voxel phantom.</span>
<a name="l00253"></a>00253 <span class="comment"></span><span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span>__constant__
<a name="l00255"></a>00255 <span class="preprocessor">#endif</span>
<a name="l00256"></a><a class="code" href="MC-GPU__v1_81_8h.html#129396d7723d11e10c673c1171773cdc">00256</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structvoxel__struct.html" title="Structure defining a voxelized box with the back-lower corner at the coordinate origin...">voxel_struct</a>    <a class="code" href="MC-GPU__v1_81_8h.html#129396d7723d11e10c673c1171773cdc" title="Global variable to be stored in the GPU constant memory defining the size of the...">voxel_data_CONST</a>;      <span class="comment">// Define the geometric constants</span>
<a name="l00257"></a>00257 <span class="comment"></span>
<a name="l00258"></a>00258 <span class="comment">//! Global variable to be stored in the GPU constant memory defining the x-ray source.</span>
<a name="l00259"></a>00259 <span class="comment"></span><span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00260"></a>00260 <span class="preprocessor"></span>__constant__
<a name="l00261"></a>00261 <span class="preprocessor">#endif</span>
<a name="l00262"></a><a class="code" href="MC-GPU__v1_81_8h.html#1b4da9b1f73994c4ed1aa7aafd036428">00262</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structsource__struct.html" title="Structure storing the data defining the source model.">source_struct</a>   <a class="code" href="MC-GPU__v1_81_8h.html#1b4da9b1f73994c4ed1aa7aafd036428" title="Global variable to be stored in the GPU constant memory defining the x-ray source...">source_data_CONST</a>;     <span class="comment">// Define a particles source.</span>
<a name="l00263"></a>00263 <span class="comment"></span>
<a name="l00264"></a>00264 <span class="comment">//! Global variable to be stored in the GPU constant memory defining the x-ray detector.</span>
<a name="l00265"></a>00265 <span class="comment"></span><span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00266"></a>00266 <span class="preprocessor"></span>__constant__
<a name="l00267"></a>00267 <span class="preprocessor">#endif</span>
<a name="l00268"></a><a class="code" href="MC-GPU__v1_81_8h.html#ea632931ac52bff8d7c9e9cb4e63fd7a">00268</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structdetector__struct.html" title="Structure storing the data defining the x-ray detector.">detector_struct</a> <a class="code" href="MC-GPU__v1_81_8h.html#ea632931ac52bff8d7c9e9cb4e63fd7a" title="Global variable to be stored in the GPU constant memory defining the x-ray detector...">detector_data_CONST</a>;   <span class="comment">// Define a detector layer perpendicular to the y axis</span>
<a name="l00269"></a>00269 <span class="comment"></span>
<a name="l00270"></a>00270 <span class="comment">//! Global variable to be stored in the GPU constant memory defining the linear interpolation data.</span>
<a name="l00271"></a>00271 <span class="comment"></span><span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>__constant__
<a name="l00273"></a>00273 <span class="preprocessor">#endif</span>
<a name="l00274"></a><a class="code" href="MC-GPU__v1_81_8h.html#8a3e410fb23d04f8a27d3d71c2381d24">00274</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structlinear__interp.html" title="Structure with the basic data required by the linear interpolation of the mean free...">linear_interp</a>   <a class="code" href="MC-GPU__v1_81_8h.html#8a3e410fb23d04f8a27d3d71c2381d24" title="Global variable to be stored in the GPU constant memory defining the linear interpolation...">mfp_table_data_CONST</a>;  <span class="comment">// Define size of interpolation arrays</span>
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 <span class="comment"></span>
<a name="l00278"></a>00278 <span class="comment">//// *** GLOBAL FUNCTIONS *** ////</span>
<a name="l00279"></a>00279 <span class="comment"></span>
<a name="l00280"></a>00280 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00281"></a>00281 <span class="preprocessor"></span>__global__
<a name="l00282"></a>00282 <span class="keywordtype">void</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#0ea66eae6d288c9e4d2456ee1033429f" title="Initialize the image array, ie, set all pixels to zero Essentially, this function...">init_image_array_GPU</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>* image, <span class="keywordtype">int</span> pixels_per_image);
<a name="l00283"></a>00283 <span class="preprocessor">#endif</span>
<a name="l00284"></a>00284 <span class="preprocessor"></span>
<a name="l00285"></a>00285 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span>__global__
<a name="l00287"></a>00287 <span class="keywordtype">void</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#bca9364385e0606e5a89c50ff0e8d54a" title="Main function to simulate x-ray tracks inside a voxelized geometry.">track_particles</a>(<span class="keywordtype">int</span> histories_per_thread, <span class="keywordtype">int</span> num_p, <span class="keywordtype">int</span> seed_input, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>* image, float2* voxel_mat_dens, float2* mfp_Woodcock_table, float3* mfp_table_a, float3* mfp_table_b, <span class="keyword">struct</span> <a class="code" href="structrayleigh__struct.html" title="Structure storing the data of the Rayleigh interaction sampling model (equivalent...">rayleigh_struct</a>* rayleigh_table, <span class="keyword">struct</span> <a class="code" href="structcompton__struct.html" title="Structure storing the data of the Compton interaction sampling model (equivalent...">compton_struct</a>* compton_table);
<a name="l00288"></a>00288 <span class="preprocessor">#else</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#bca9364385e0606e5a89c50ff0e8d54a" title="Main function to simulate x-ray tracks inside a voxelized geometry.">track_particles</a>(<span class="keywordtype">int</span> history_batch, <span class="keywordtype">int</span> histories_per_thread, <span class="keywordtype">int</span> num_p, <span class="keywordtype">int</span> seed_input, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>* image, float2* voxel_mat_dens, float2* mfp_Woodcock_table, float3* mfp_table_a, float3* mfp_table_b, <span class="keyword">struct</span> <a class="code" href="structrayleigh__struct.html" title="Structure storing the data of the Rayleigh interaction sampling model (equivalent...">rayleigh_struct</a>* rayleigh_table, <span class="keyword">struct</span> <a class="code" href="structcompton__struct.html" title="Structure storing the data of the Compton interaction sampling model (equivalent...">compton_struct</a>* compton_table);
<a name="l00290"></a>00290 <span class="preprocessor">#endif</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>
<a name="l00292"></a>00292 <span class="comment"></span>
<a name="l00293"></a>00293 <span class="comment">//// *** DEVICE FUNCTIONS *** ////</span>
<a name="l00294"></a>00294 <span class="comment"></span>
<a name="l00295"></a>00295 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>__device__
<a name="l00297"></a>00297 <span class="preprocessor">#endif</span>
<a name="l00298"></a>00298 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#d58a7b0dc497439d0d63e9015b0aa0cb" title="Source that creates primary x rays, according to the defined source model.">source</a>(<span class="keywordtype">int</span>* num_p, float3* position, float3* direction, <span class="keywordtype">float</span>* energy, int2* seed, <span class="keywordtype">int</span>* absvox);
<a name="l00299"></a>00299 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00300"></a>00300 <span class="preprocessor"></span>__device__
<a name="l00301"></a>00301 <span class="preprocessor">#endif</span>
<a name="l00302"></a>00302 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#89bad1e6819d520cce606a8aa8f2cfbc" title="Evaluate if the input distance will move the particle inside the voxels or if another...">set_position</a>(<span class="keywordtype">int</span>* num_p, <span class="keywordtype">float</span>* dist, float3* position, float3* direction);
<a name="l00303"></a>00303 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>__device__
<a name="l00305"></a>00305 <span class="preprocessor">#endif</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#72817a5712f873a61ad5408a781620be" title="Tally a radiographic projection image.">tally_image</a>(<span class="keywordtype">int</span>* num_p, <span class="keywordtype">float</span>* energy, float3* position, float3* direction, <span class="keywordtype">signed</span> <span class="keywordtype">char</span>* scatter_state, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>* image, float3* detector_center_SHARED);
<a name="l00307"></a>00307 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span>__device__
<a name="l00309"></a>00309 <span class="preprocessor">#endif</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#e7bd0b93b4d5eedb15822fa0ef622b48" title="Initialize the pseudo-random number generator (PRNG) RANECU to a position far away...">init_PRNG</a>(<span class="keywordtype">int</span> history_batch, <span class="keywordtype">int</span> histories_per_thread, <span class="keywordtype">int</span> seed_input, int2* seed);
<a name="l00311"></a>00311 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00312"></a>00312 <span class="preprocessor"></span>__device__
<a name="l00313"></a>00313 <span class="preprocessor">#endif</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#e9061f4314474bf4415200a5cb115397" title="Calculate &amp;quot;(a1*a2) MOD m&amp;quot; with 32-bit integers and avoiding the possible...">abMODm</a>(<span class="keywordtype">int</span> m, <span class="keywordtype">int</span> a, <span class="keywordtype">int</span> s);
<a name="l00315"></a>00315 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>__device__
<a name="l00317"></a>00317 <span class="preprocessor">#endif</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#3b57f2faa5765ceba5d352641ca72a9f" title="Pseudo-random number generator (PRNG) RANECU returning a float value (single precision...">ranecu</a>(int2* seed);
<a name="l00319"></a>00319 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>__device__
<a name="l00321"></a>00321 <span class="preprocessor">#endif</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#74c4894502584f8fb113e04b759a6c55" title="Pseudo-random number generator (PRNG) RANECU returning a double value.">ranecu_double</a>(int2* seed);
<a name="l00323"></a>00323 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00324"></a>00324 <span class="preprocessor"></span>__device__
<a name="l00325"></a>00325 <span class="preprocessor">#endif</span>
<a name="l00326"></a>00326 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#6ce03af860514f703cbf18f217ec1df0" title="Find the voxel that contains the current position.">locate_voxel</a>(float3* position);
<a name="l00327"></a>00327 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00328"></a>00328 <span class="preprocessor"></span>__device__
<a name="l00329"></a>00329 <span class="preprocessor">#endif</span>
<a name="l00330"></a>00330 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#94ad9ed794eb8fd696e7e357ae391765" title="Rotates a vector; the rotation is specified by giving the polar and azimuthal angles...">rotate_double</a>(float3* direction, <span class="keywordtype">double</span> cos_theta, <span class="keywordtype">double</span> phi);
<a name="l00331"></a>00331 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00332"></a>00332 <span class="preprocessor"></span>__device__
<a name="l00333"></a>00333 <span class="preprocessor">#endif</span>
<a name="l00334"></a>00334 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#5cafd4ebb3d155746b16ca7d231ecad1" title="Sample a Rayleigh interaction using the sampling algorithm used in PENELOPE 2006...">GRAa</a>(<span class="keywordtype">float</span> *energy, <span class="keywordtype">double</span> *costh_Rayleigh, <span class="keywordtype">int</span> *mat, <span class="keywordtype">float</span> *pmax_current, int2 *seed, <span class="keyword">struct</span> <a class="code" href="structrayleigh__struct.html" title="Structure storing the data of the Rayleigh interaction sampling model (equivalent...">rayleigh_struct</a>* cgra);
<a name="l00335"></a>00335 <span class="preprocessor">#ifdef USING_CUDA</span>
<a name="l00336"></a>00336 <span class="preprocessor"></span>__device__
<a name="l00337"></a>00337 <span class="preprocessor">#endif</span>
<a name="l00338"></a>00338 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="MC-GPU__kernel__v1_81_8cu.html#6f212862e7fba1553ec9495f05443b2c" title="Random sampling of incoherent (Compton) scattering of photons, using the sampling...">GCOa</a>(<span class="keywordtype">float</span> *energy, <span class="keywordtype">double</span> *costh_Compton, <span class="keywordtype">int</span> *mat, int2 *seed, <span class="keyword">struct</span> <a class="code" href="structcompton__struct.html" title="Structure storing the data of the Compton interaction sampling model (equivalent...">compton_struct</a>* cgco_SHARED);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 <span class="comment">// -- END OF THE "ifndef MCGPU_H_" statement:</span>
<a name="l00341"></a>00341 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Jun 3 13:10:12 2010 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
